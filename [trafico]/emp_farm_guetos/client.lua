local Tunnel = module("vrp","lib/Tunnel")
local Proxy = module("vrp","lib/Proxy")
emP = Tunnel.getInterface("emp_farm_guetos")
vRP = Proxy.getInterface("vRP")
-----------------------------------------------------------------------------------------------------------------------------------------
-- VARIAVEIS
-----------------------------------------------------------------------------------------------------------------------------------------
local blips = false
local servico = false
local selecionado = 0

local Coordenadas = {
	{78.63,-1975.06,20.93}, -- BALLAS
	{-145.86,-1614.11,36.05}, -- GROOVE
	{340.1,-2098.5,18.2}, -- VAGOS
	{1379.3,-1514.82,58.44}, -- CRIPS
	{94.42,-1294.05,29.27}, -- VANILLA
	{559.03,-1777.21,33.45}, -- BLOODS
	{-1570.76,-574.88,108.53}, -- MAFIA2
	{996.81,2889.42,31.12}, --YAKUZA
	-- {1446.09,-1667.6,66.13},-- LIBERTY
	{-1389.35,-591.84,30.31}, --BAHAMAS
}

local inicio = 0
local fim = 0

-----------------------------------------------------------------------------------------------------------------------------------------
-- LOCALIZACAO 
-----------------------------------------------------------------------------------------------------------------------------------------
local locs = {
	[1] = { ['x'] = 1355.12, ['y'] = -1690.60, ['z'] = 60.49 },--1355.12,-1690.60,60.49
	[2] = { ['x'] = 970.78, ['y'] = -199.50, ['z'] = 73.20 }, -- 970.78,-199.50,73.20
	[3] = { ['x'] = 1212.98, ['y'] = -552.92, ['z'] = 69.17 }, -- 1212.98,-552.92,69.17
	[4] = { ['x'] = -3093.80, ['y'] = 349.27, ['z'] = 7.54 }, -- -3093.80,349.27,7.54
	[5] = { ['x'] = -1097.43, ['y'] = -1672.99, ['z'] = 8.39 }, -- -1097.43,-1672.99,8.39
	[6] = { ['x'] = -1613.24, ['y'] = -1028.10, ['z'] = 13.15 }, ---295.06,-2604.96,6.19
	[7] = { ['x'] = 196.5, ['y'] = -1690.99, ['z'] = 29.62 }, -- 196.5,-1690.99,29.62
	[8] = { ['x'] = 818.28, ['y'] = -1375.55, ['z'] = 26.32 }, -- 818.28,-1375.55,26.32
	[9] = { ['x'] = -688.73, ['y'] = -141.88, ['z'] = 37.84 }, -- -688.73,-141.88,37.84
	[10] = { ['x'] = 359.69, ['y'] = 356.52, ['z'] = 104.33 }, -- 359.69,356.52,104.33
	[11] = { ['x'] = 675.21, ['y'] = -2725.68, ['z'] = 7.18 }, -- 675.21,-2725.68,7.18

	[12] = { ['x'] = 191.43, ['y'] = -2226.55, ['z'] = 6.97 }, --191.43,-2226.55,6.97
	[13] = { ['x'] = -903.51, ['y'] = -1005.46, ['z'] = 2.15 }, ---1642.75,-1046.89,13.30
	[14] = { ['x'] = -3105, ['y'] = 246.82, ['z'] = 12.5 }, -- -3105.25,246.82,12.5
	[15] = { ['x'] = 1160.70, ['y'] = -311.57, ['z'] = 69.27 }, --1160.70,-311.57,69.27
	[16] = { ['x'] = 1086.49, ['y'] = -2400.11, ['z'] = 30.57 }, -- 1086.49,-24.14,30.58 
	[17] = { ['x'] = -429.16, ['y'] = -1728.11, ['z'] = 19.78 }, ---429.16,-1728.11,19.78
	[18] = { ['x'] = 1082.59, ['y'] = -787.55, ['z'] = 58.33 },-- 1082.59,-787.55,58.33
	[19] = { ['x'] = -430.94, ['y'] = 289.01, ['z'] = 86.06 }, ---430.94,289.01,86.06
	[20] = { ['x'] = -328.41, ['y'] = -2700.41, ['z'] = 7.54 },-- -328.41,-2700.41,7.54
	[21] = { ['x'] = -1244.10, ['y'] = -1240.34, ['z'] = 11.02 },-- -1244.10,-1240.34,11.02
	[22] = { ['x'] = 66.81, ['y'] = -253.46, ['z'] = 52.35 },-- 66.81,-253.46,52.35

	[23] = { ['x'] = 1236.91, ['y'] = -3008.62, ['z'] = 9.31 },-- 1214.11,-1643.89,48.64
	[24] = { ['x'] = -1102.15, ['y'] = -1492.6, ['z'] = 4.89 },-- -1102.15,-1492.6,4.89
	[25] = { ['x'] = -1829.21, ['y'] = 801.0, ['z'] = 138.42 },-- -1829.21,801.0,138.42
	[26] = { ['x'] = -3049.84, ['y'] = 474.72, ['z'] = 6.78 },-- -3049.84,474.72,6.78
	[27] = { ['x'] = 1250.56, ['y'] = -1966.17, ['z'] = 44.32 },-- 1250.56,-1966.17,44.32
	[28] = { ['x'] = 997.08, ['y'] = -729.59, ['z'] = 57.82 },-- 997.08,-729.59,57.82
	[29] = { ['x'] = -43.59, ['y'] = -2520.00, ['z'] = 7.39 },-- -43.59,-2520.00,7.39
	[30] = { ['x'] = -1161.52, ['y'] = -1099.59, ['z'] = 2.20 },-- -1161.52,-1099.59,2.20
	[31] = { ['x'] = 1224.74, ['y'] = 2728.44, ['z'] = 38.00 },-- 380.13,356.97,102.57
	[32] = { ['x'] = 844.31, ['y'] = -2118.34, ['z'] = 30.52 },-- 844.31,-2118.34,30.52
	[33] = { ['x'] = 167.72, ['y'] = -2222.32, ['z'] = 7.23 },-- 167.72,-2222.32,7.23

	[34] = { ['x'] = 1236.91, ['y'] = -3008.62, ['z'] = 9.31 },-- 1214.11,-1643.89,48.64
	[35] = { ['x'] = -1102.15, ['y'] = -1492.6, ['z'] = 4.89 },-- -1102.15,-1492.6,4.89
	[36] = { ['x'] = -1829.21, ['y'] = 801.0, ['z'] = 138.42 },-- -1829.21,801.0,138.42
	[37] = { ['x'] = -3049.84, ['y'] = 474.72, ['z'] = 6.78 },-- -3049.84,474.72,6.78
	[38] = { ['x'] = 1250.56, ['y'] = -1966.17, ['z'] = 44.32 },-- 1250.56,-1966.17,44.32
	[39] = { ['x'] = 997.08, ['y'] = -729.59, ['z'] = 57.82 },-- 997.08,-729.59,57.82
	[40] = { ['x'] = -43.59, ['y'] = -2520.00, ['z'] = 7.39 },-- -43.59,-2520.00,7.39
	[41] = { ['x'] = -1161.52, ['y'] = -1099.59, ['z'] = 2.20 },-- -1161.52,-1099.59,2.20
	[42] = { ['x'] = 1224.74, ['y'] = 2728.44, ['z'] = 38.00 },-- 380.13,356.97,102.57
	[43] = { ['x'] = 844.31, ['y'] = -2118.34, ['z'] = 30.52 },-- 844.31,-2118.34,30.52
	[44] = { ['x'] = 167.72, ['y'] = -2222.32, ['z'] = 7.23 },-- 167.72,-2222.32,7.23

	[45] = { ['x'] = 1236.91, ['y'] = -3008.62, ['z'] = 9.31 },-- 1214.11,-1643.89,48.64
	[46] = { ['x'] = -1102.15, ['y'] = -1492.6, ['z'] = 4.89 },-- -1102.15,-1492.6,4.89
	[47] = { ['x'] = -1829.21, ['y'] = 801.0, ['z'] = 138.42 },-- -1829.21,801.0,138.42
	[48] = { ['x'] = -3049.84, ['y'] = 474.72, ['z'] = 6.78 },-- -3049.84,474.72,6.78
	[49] = { ['x'] = 1250.56, ['y'] = -1966.17, ['z'] = 44.32 },-- 1250.56,-1966.17,44.32
	[50] = { ['x'] = 997.08, ['y'] = -729.59, ['z'] = 57.82 },-- 997.08,-729.59,57.82
	[51] = { ['x'] = -43.59, ['y'] = -2520.00, ['z'] = 7.39 },-- -43.59,-2520.00,7.39
	[52] = { ['x'] = -1161.52, ['y'] = -1099.59, ['z'] = 2.20 },-- -1161.52,-1099.59,2.20
	[53] = { ['x'] = 1224.74, ['y'] = 2728.44, ['z'] = 38.00 },-- 380.13,356.97,102.57
	[54] = { ['x'] = 844.31, ['y'] = -2118.34, ['z'] = 30.52 },-- 844.31,-2118.34,30.52
	[55] = { ['x'] = 167.72, ['y'] = -2222.32, ['z'] = 7.23 },-- 167.72,-2222.32,7.23

	[56] = { ['x'] = 1355.12, ['y'] = -1690.60, ['z'] = 60.49 },--1355.12,-1690.60,60.49
	[57] = { ['x'] = 970.78, ['y'] = -199.50, ['z'] = 73.20 }, -- 970.78,-199.50,73.20
	[58] = { ['x'] = 1212.98, ['y'] = -552.92, ['z'] = 69.17 }, -- 1212.98,-552.92,69.17
	[59] = { ['x'] = -3093.80, ['y'] = 349.27, ['z'] = 7.54 }, -- -3093.80,349.27,7.54
	[60] = { ['x'] = -1097.43, ['y'] = -1672.99, ['z'] = 8.39 }, -- -1097.43,-1672.99,8.39
	[61] = { ['x'] = -1613.24, ['y'] = -1028.10, ['z'] = 13.15 }, ---295.06,-2604.96,6.19
	[62] = { ['x'] = 196.5, ['y'] = -1690.99, ['z'] = 29.62 }, -- 196.5,-1690.99,29.62
	[63] = { ['x'] = 818.28, ['y'] = -1375.55, ['z'] = 26.32 }, -- 818.28,-1375.55,26.32
	[64] = { ['x'] = -688.73, ['y'] = -141.88, ['z'] = 37.84 }, -- -688.73,-141.88,37.84
	[65] = { ['x'] = 359.69, ['y'] = 356.52, ['z'] = 104.33 }, -- 359.69,356.52,104.33
	[66] = { ['x'] = 675.21, ['y'] = -2725.68, ['z'] = 7.18 }, -- 675.21,-2725.68,7.18

	[67] = { ['x'] = 1236.91, ['y'] = -3008.62, ['z'] = 9.31 },-- 1214.11,-1643.89,48.64
	[68] = { ['x'] = -1102.15, ['y'] = -1492.6, ['z'] = 4.89 },-- -1102.15,-1492.6,4.89
	[69] = { ['x'] = -1829.21, ['y'] = 801.0, ['z'] = 138.42 },-- -1829.21,801.0,138.42
	[70] = { ['x'] = -3049.84, ['y'] = 474.72, ['z'] = 6.78 },-- -3049.84,474.72,6.78
	[71] = { ['x'] = 1250.56, ['y'] = -1966.17, ['z'] = 44.32 },-- 1250.56,-1966.17,44.32
	[72] = { ['x'] = 997.08, ['y'] = -729.59, ['z'] = 57.82 },-- 997.08,-729.59,57.82
	[73] = { ['x'] = -43.59, ['y'] = -2520.00, ['z'] = 7.39 },-- -43.59,-2520.00,7.39
	[74] = { ['x'] = -1161.52, ['y'] = -1099.59, ['z'] = 2.20 },-- -1161.52,-1099.59,2.20
	[75] = { ['x'] = 1224.74, ['y'] = 2728.44, ['z'] = 38.00 },-- 380.13,356.97,102.57
	[76] = { ['x'] = 844.31, ['y'] = -2118.34, ['z'] = 30.52 },-- 844.31,-2118.34,30.52
	[77] = { ['x'] = 167.72, ['y'] = -2222.32, ['z'] = 7.23 },-- 167.72,-2222.32,7.23

	[78] = { ['x'] = 1355.12, ['y'] = -1690.60, ['z'] = 60.49 },-- 1355.12,-1690.60,60.49
	[79] = { ['x'] = 970.78, ['y'] = -199.50, ['z'] = 73.20 }, -- 970.78,-199.50,73.20
	[80] = { ['x'] = -3093.80, ['y'] = 349.27, ['z'] = 7.54 }, -- -3093.80,349.27,7.54
	[81] = { ['x'] = -1097.43, ['y'] = -1672.99, ['z'] = 8.39 }, -- -1097.43,-1672.99,8.39
	[82] = { ['x'] = -295.06, ['y'] = -2604.96, ['z'] = 6.19 }, -- -295.06,-2604.96,6.19
	[83] = { ['x'] = -1303.15, ['y'] = -390.50, ['z'] = 36.69 }, -- -1303.15,-390.50,36.69
	[84] = { ['x'] = 819.59, ['y'] = -2155.35, ['z'] = 29.62 }, -- 819.59,-2155.35,29.62
	[85] = { ['x'] = -1055.94, ['y'] = -1001.01, ['z'] = 2.16 }, -- -1055.94,-1001.01,2.16
	[86] = { ['x'] = -68.12, ['y'] = 214.31, ['z'] = 97.23 }, -- -68.12,214.31,97.23
	[87] = { ['x'] = 1240.70, ['y'] = -3238.82, ['z'] = 6.02 }, --1240.7052001953,-3238.82,6.02
	[88] = { ['x'] = 191.43, ['y'] = -2226.55, ['z'] = 6.97 }, --191.43740844727,-2226.55,6.97

	[89] = { ['x'] = 1020.95, ['y'] = -2434.56, ['z'] = 29.65 },
	[97] = { ['x'] = 990.02, ['y'] = -1853.13, ['z'] = 31.03 }, 
	[95] = { ['x'] = -1098.34, ['y'] = -1678.60, ['z'] = 4.35 },
	[92] = { ['x'] = -1102.25, ['y'] = -1492.22, ['z'] = 4.88 }, 
	[98] = { ['x'] = 1099.75, ['y'] = -345.82, ['z'] = 67.18 }, 
	[94] = { ['x'] = 1135.10, ['y'] = -789.30, ['z'] = 57.60 }, 
	[91] = { ['x'] = -1585.56, ['y'] = -838.25, ['z'] = 9.95 },
	[96] = { ['x'] = -106.21, ['y'] = 25.15, ['z'] = 71.36 }, 
	[90] = { ['x'] = -3187.03, ['y'] = 1273.73, ['z'] = 12.66 }, 
	[93] = { ['x'] = -3228.58, ['y'] = 927.64, ['z'] = 13.96 },

}
-----------------------------------------------------------------------------------------------------------------------------------------
-- LOCAL PARA INICIAR COLETA
-----------------------------------------------------------------------------------------------------------------------------------------
Citizen.CreateThread(function()
	SetNuiFocus(false,false)
	while true do
		Citizen.Wait(1)
		if not servico then
			for _,mark in pairs(Coordenadas) do
				local x,y,z = table.unpack(mark)
				local distance = GetDistanceBetweenCoords(GetEntityCoords(PlayerPedId()),x,y,z,true)
				if distance <= 30.0 then
					if distance <= 1.2 then
						drawTxt("PRESSIONE  ~b~E~w~  PARA INICIAR COLETA",4,0.5,0.93,0.50,255,255,255,180)
						if IsControlJustPressed(0,38) and emP.checkPermission() then
							if GetDistanceBetweenCoords(GetEntityCoords(PlayerPedId()),78.63,-1975.06,20.93,true) <= 1.2 then
								servico = true	
								inicio = 1
								fim = 11					
								selecionado = math.random(inicio,fim)
								CriandoBlip(locs,selecionado)
							elseif GetDistanceBetweenCoords(GetEntityCoords(PlayerPedId()),-145.86,-1614.11,36.05,true) <= 1.2 then
								servico = true						
								inicio = 12
								fim = 22						
								selecionado = math.random(inicio,fim)
								CriandoBlip(locs,selecionado)
							elseif GetDistanceBetweenCoords(GetEntityCoords(PlayerPedId()),340.1,-2098.5,18.2,true) <= 1.2 then
								servico = true							
								inicio = 23
								fim = 33						
								selecionado = math.random(inicio,fim)
								CriandoBlip(locs,selecionado)
							elseif GetDistanceBetweenCoords(GetEntityCoords(PlayerPedId()),1379.3,-1514.82,58.44,true) <= 1.2 then
								servico = true							
								inicio = 33
								fim = 44						
								selecionado = math.random(inicio,fim)
								CriandoBlip(locs,selecionado)
							elseif GetDistanceBetweenCoords(GetEntityCoords(PlayerPedId()),94.42,-1294.05,29.27,true) <= 1.2 then
								servico = true							
								inicio = 44
								fim = 55					
								selecionado = math.random(inicio,fim)
								CriandoBlip(locs,selecionado)
							elseif GetDistanceBetweenCoords(GetEntityCoords(PlayerPedId()),559.03,-1777.21,33.45,true) <= 1.2 then
								servico = true							
								inicio = 55
								fim = 66					
								selecionado = math.random(inicio,fim)
								CriandoBlip(locs,selecionado)
							elseif GetDistanceBetweenCoords(GetEntityCoords(PlayerPedId()),-1570.76,-574.88,108.53,true) <= 1.2 then
								servico = true							
								inicio = 66
								fim = 77					
								selecionado = math.random(inicio,fim)
								CriandoBlip(locs,selecionado)
							elseif GetDistanceBetweenCoords(GetEntityCoords(PlayerPedId()),114.28,-2003.29,18.31,true) <= 1.2 then
								servico = true							
								inicio = 77
								fim = 88					
								selecionado = math.random(inicio,fim)
								CriandoBlip(locs,selecionado)
							elseif GetDistanceBetweenCoords(GetEntityCoords(PlayerPedId()),-1389.35,-591.84,30.31,true) <= 1.2 then  ---1386.07,-627.27,30.81
								servico = true							
								inicio = 89
								fim = 98					
								selecionado = math.random(inicio,fim)
								CriandoBlip(locs,selecionado)
							end				
						end
					end
				end
			end
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- COLETAR COMPONENTES - BALLAS
-----------------------------------------------------------------------------------------------------------------------------------------	
Citizen.CreateThread(function()
	while true do
		Citizen.Wait(1)
		if servico then
			local ped = PlayerPedId()
			local x,y,z = table.unpack(GetEntityCoords(ped))
			local bowz,cdz = GetGroundZFor_3dCoord(locs[selecionado].x,locs[selecionado].y,locs[selecionado].z)
			local distance = GetDistanceBetweenCoords(locs[selecionado].x,locs[selecionado].y,cdz,x,y,z,true)
			if distance <= 30.0 then
				DrawMarker(21,locs[selecionado].x,locs[selecionado].y,locs[selecionado].z-0.27,0,0,0,0,0,0,0.5,0.5,-0.5,255,255,255,25,1,0,0,1)
				if distance <= 1.2 then
					drawTxt("PRESSIONE  ~b~E~w~  PARA COLETAR",4,0.5,0.93,0.50,255,255,255,180)
					if IsControlJustPressed(0,38) then
						if emP.checkPayment() then

							RemoveBlip(blips)
							backentrega = selecionado
							while true do
								if backentrega == selecionado then
									selecionado = math.random(inicio,fim)
								else
									break
								end
								Citizen.Wait(1)
							end
							CriandoBlip(locs,selecionado)
						end
					end
				end
			end
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- FUNÇÕES
-----------------------------------------------------------------------------------------------------------------------------------------
Citizen.CreateThread(function()
	while true do
		Citizen.Wait(1)
		if servico then
			drawTxt("PRESSIONE ~r~F7~w~ SE DESEJA FINALIZAR",4,0.227,0.935,0.448,255,255,255,100)
			drawTxt("VA ATÉ O DESTINO E COLETE OS ~g~COMPONENTES~w~.",4,0.252,0.956,0.48,255,255,255,220)
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CANCELAR
-----------------------------------------------------------------------------------------------------------------------------------------
Citizen.CreateThread(function()
	while true do
		Citizen.Wait(1)
		if servico then
			if IsControlJustPressed(0,168) then
				servico = false
				RemoveBlip(blips)
			end
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- FUNÇÕES
-----------------------------------------------------------------------------------------------------------------------------------------
function drawTxt(text,font,x,y,scale,r,g,b,a)
	SetTextFont(font)
	SetTextScale(scale,scale)
	SetTextColour(r,g,b,a)
	SetTextOutline()
	SetTextCentre(1)
	SetTextEntry("STRING")
	AddTextComponentString(text)
	DrawText(x,y)
end

function CriandoBlip(locs,selecionado)
	blips = AddBlipForCoord(locs[selecionado].x,locs[selecionado].y,locs[selecionado].z)
	SetBlipSprite(blips,1)
	SetBlipColour(blips,5)
	SetBlipScale(blips,0.4)
	SetBlipAsShortRange(blips,false)
	SetBlipRoute(blips,true)
	BeginTextCommandSetBlipName("STRING")
	AddTextComponentString("Coleta de Componentes")
	EndTextCommandSetBlipName(blips)
end


